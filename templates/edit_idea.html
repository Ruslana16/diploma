{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Rediģēt ideju</h1>
    <form method="POST" action="{{ url_for('edit_idea', idea_id=idea.id) }}">
        {{ form.hidden_tag() }}
        <div class="form-group">
            <label for="title">Nosaukums</label>
            {{ form.title(class="form-control", id="title") }}
            {% if form.title.errors %}
                <div class="text-danger">
                    {% for error in form.title.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="form-group">
            <label for="description">Apraksts</label>
            {{ form.description(class="form-control", id="description") }}
            {% if form.description.errors %}
                <div class="text-danger">
                    {% for error in form.description.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="form-group">
            <label for="category">Kategorija</label>
            {{ form.category(class="form-control", id="category") }}
            {% if form.category.errors %}
                <div class="text-danger">
                    {% for error in form.category.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <h5 class="mt-4">Balsošanas opcijas</h5>
        <div id="voting-options">
            {% for voting_option in form.voting_options %}
                <div class="form-group">
                    <label for="voting_options-{{ loop.index0 }}-option_text">Opcija</label>
                    {{ voting_option.option_text(class="form-control", id="voting_options-{{ loop.index0 }}-option_text") }}
                    {% if voting_option.option_text.errors %}
                        <div class="text-danger">
                            {% for error in voting_option.option_text.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <button type="button" class="btn btn-secondary" onclick="addVotingOption()">Pievienot opciju</button>
        <div class="form-group mt-3">
            <button type="submit" class="btn btn-primary">Atjaunināt ideju</button>
        </div>
    </form>
</div>

<script>
    const csrfToken = '{{ form.csrf_token() }}';  // Store CSRF token in a JavaScript variable
    let index = {{ form.voting_options|length }};  // Start from the current length of the voting options

    function addVotingOption() {
        const container = document.getElementById('voting-options');
        const option = document.createElement('div');
        option.classList.add('form-group');
        option.innerHTML = `
            <label for="voting_options-${index}-option_text">Opcija</label>
            <input class="form-control" id="voting_options-${index}-option_text" name="voting_options-${index}-option_text" type="text">
            <input type="hidden" name="csrf_token" value="${csrfToken}">
        `;
        container.appendChild(option);
        index++;
    }
</script>
{% endblock %}










